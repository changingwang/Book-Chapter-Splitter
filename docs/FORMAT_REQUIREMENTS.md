# 书籍章节拆分器 - 格式要求规范

本文档详细说明了书籍章节拆分器对输入 Markdown 文档的格式要求，适用于用户手动编辑和大模型自动处理场景。

## 📋 目录

- [核心格式要求](#核心格式要求)
- [章节标题规范](#章节标题规范)
- [小节标题规范](#小节标题规范)
- [文档结构要求](#文档结构要求)
- [常见错误格式](#常见错误格式)
- [大模型处理指导](#大模型处理指导)
- [格式修复工具](#格式修复工具)
- [验证清单](#验证清单)

## 🎯 核心格式要求

### ⚠️ 关键规则

1. **章节标题不能包含下划线 `_`**
2. **章节标题必须使用一级标题 `#`**
3. **小节标题使用中文数字格式**
4. **保持层次结构清晰**

## 📖 章节标题规范

### ✅ 支持的章节标题格式

```markdown
# 第一章 导论：对象和地位
# 第二章 政治是经济的集中表现
# 第三章 政治是各阶级之间的斗争
# 第1章 基础理论
# 第2章 实践应用
```

### ❌ 不支持的章节标题格式

```markdown
# 第一章_导论：对象和地位          ❌ 包含下划线
## 第一章 导论：对象和地位         ❌ 使用二级标题
第一章 导论：对象和地位           ❌ 缺少 # 号
# Chapter 1 Introduction         ❌ 英文格式
# 1. 导论：对象和地位             ❌ 使用数字点号
# 一、导论：对象和地位             ❌ 使用中文序号
```

### 🔧 章节标题格式规则

1. **必须以 `#` 开头**（一级标题）
2. **章节编号格式**：
   - 中文数字：`第一章`、`第二章`、`第三章`...
   - 阿拉伯数字：`第1章`、`第2章`、`第3章`...
3. **标题内容**：
   - 使用空格分隔章节号和标题内容
   - 不能包含下划线 `_`
   - 可以包含冒号 `:`、中文标点符号
4. **示例模式**：`# 第X章 标题内容`

## 📝 小节标题规范

### ✅ 支持的小节标题格式

```markdown
一、小节标题
二、小节标题
三、小节标题
1、小节标题
2、小节标题
3、小节标题
（一）小节标题
（二）小节标题
（三）小节标题
(一)小节标题
(二)小节标题
(三)小节标题
```

### ❌ 不支持的小节标题格式

```markdown
## 一、小节标题                   ❌ 使用 Markdown 标题
# 一、小节标题                    ❌ 使用一级标题
1. 小节标题                      ❌ 使用 Markdown 列表
- 一、小节标题                   ❌ 使用 Markdown 列表
```

### 🔧 小节标题格式规则

1. **不使用 Markdown 标题语法**（不用 `#` 或 `##`）
2. **支持的序号格式**：
   - 中文数字：`一、`、`二、`、`三、`...
   - 阿拉伯数字：`1、`、`2、`、`3、`...
   - 中文括号：`（一）`、`（二）`、`（三）`...
   - 英文括号：`(一)`、`(二)`、`(三)`...
3. **位置要求**：必须在章节内容中，不能独立存在

## 🏗️ 文档结构要求

### 标准文档结构

```markdown
# 文档标题

# 第一章 章节标题

章节介绍内容...

一、第一个小节

小节内容...

二、第二个小节

小节内容...

# 第二章 另一个章节

章节介绍内容...

一、第一个小节

小节内容...
```

### 层次结构规则

1. **文档标题**：可选，使用一级标题 `#`
2. **章节**：必须，使用一级标题 `# 第X章`
3. **小节**：可选，使用中文序号格式
4. **内容**：章节和小节下的正文内容

## ❌ 常见错误格式

### 1. 下划线问题

```markdown
❌ 错误：
# 第一章_导论：对象和地位
# 第二章_政治是经济的集中表现

✅ 正确：
# 第一章 导论：对象和地位
# 第二章 政治是经济的集中表现
```

### 2. 标题级别问题

```markdown
❌ 错误：
## 第一章 导论：对象和地位
### 第二章 政治是经济的集中表现

✅ 正确：
# 第一章 导论：对象和地位
# 第二章 政治是经济的集中表现
```

### 3. 章节编号问题

```markdown
❌ 错误：
# 1. 导论：对象和地位
# 一、政治是经济的集中表现
# Chapter 1 Introduction

✅ 正确：
# 第一章 导论：对象和地位
# 第二章 政治是经济的集中表现
# 第三章 基础理论
```

### 4. 小节格式问题

```markdown
❌ 错误：
## 一、小节标题
# 1、小节标题
- 一、小节标题

✅ 正确：
一、小节标题
1、小节标题
（一）小节标题
```

## 🤖 大模型处理指导

### 处理原则

1. **格式标准化**：确保所有章节标题符合规范
2. **结构清晰**：保持章节和小节的层次关系
3. **内容完整**：不遗漏原始内容
4. **编码正确**：使用 UTF-8 编码

### 处理步骤

1. **识别章节结构**
   ```
   - 查找所有章节标题
   - 确认章节编号顺序
   - 检查标题格式是否符合规范
   ```

2. **修复格式问题**
   ```
   - 将下划线替换为空格
   - 统一章节标题为一级标题
   - 规范化章节编号格式
   ```

3. **处理小节内容**
   ```
   - 识别小节标题
   - 保持小节在对应章节内
   - 确保小节序号连续
   ```

4. **验证输出**
   ```
   - 检查所有章节标题格式
   - 确认文档结构完整
   - 验证内容无遗漏
   ```

### 大模型处理示例

**输入文档（需要修复）：**
```markdown
# 第一章_导论：对象和地位

## 第二章_政治是经济的集中表现

### 一、基本概念
```

**处理后输出：**
```markdown
# 第一章 导论：对象和地位

# 第二章 政治是经济的集中表现

一、基本概念
```

### 处理提示词模板

```
请将以下 Markdown 文档转换为符合书籍章节拆分器要求的格式：

要求：
1. 章节标题必须使用一级标题 # 开头
2. 章节标题格式：# 第X章 标题内容
3. 章节标题中不能包含下划线 _，请替换为空格
4. 小节标题使用中文序号格式（一、二、三、或 1、2、3、）
5. 小节标题不使用 Markdown 标题语法
6. 保持原始内容完整，只修改格式

原始文档：
[在此插入原始文档内容]
```

## 🔧 格式修复工具

### 自动修复工具

项目提供了自动修复工具 `fix_chapter_titles.py`：

```bash
# 运行修复工具
python fix_chapter_titles.py

# 功能：
# - 自动识别章节标题中的下划线
# - 批量替换为空格
# - 创建备份文件
# - 显示修改详情
```

### 手动修复命令

**Linux/Mac：**
```bash
# 替换章节标题中的下划线
sed -i 's/\(^# 第.*章\)_/\1 /g' input.md
```

**Windows PowerShell：**
```powershell
# 替换章节标题中的下划线
(Get-Content input.md) -replace '(^# 第.*章)_', '$1 ' | Set-Content input.md
```

## ✅ 验证清单

### 格式检查清单

- [ ] 所有章节标题使用一级标题 `#`
- [ ] 章节标题格式为 `# 第X章 标题内容`
- [ ] 章节标题中没有下划线 `_`
- [ ] 小节标题使用中文序号格式
- [ ] 小节标题不使用 Markdown 标题语法
- [ ] 文档结构层次清晰
- [ ] 内容完整无遗漏
- [ ] 文件编码为 UTF-8

### 快速验证命令

```bash
# 检查章节标题格式
grep "^# 第.*章" input.md

# 检查是否有下划线问题
grep "^# 第.*章.*_" input.md

# 检查小节标题
grep "^[一二三四五六七八九十]、\\|^[0-9]、\\|^（[一二三四五六七八九十]）\\|^([一二三四五六七八九十])" input.md
```

## 📚 相关文档

- [README.md](../README.md) - 项目概述和快速开始
- [USAGE.md](USAGE.md) - 详细使用说明
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - 问题排查指南

---

**注意**：严格遵循本文档的格式要求可以确保书籍章节拆分器正常工作，避免格式错误导致的处理失败。